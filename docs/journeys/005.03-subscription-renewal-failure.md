# 005.03 Subscription Renewal Failure (PROPOSED)

**Persona:** Document Creator (Pro Tier)
**Goal:** Handle scenarios where a renewal payment fails

## Overview
If a recurring payment fails, the user must be notified, and access to "Pro" features should eventually be restricted if not resolved.

## Flow: Payment Failure Recovery

```mermaid
flowchart TD
    A[Stripe: invoice.payment_failed] --> B[Webhook Handler]
    B --> C[Update User Status: 'past_due' in Convex]
    C --> D[Send Warning Email (via Resend)]
    D --> E[User Logs In]
    E --> F[Banner: 'Your payment failed. Update billing']
    F --> G[Click Banner -> Stripe Portal]
    G --> H[User updates card]
    H --> I[Stripe: invoice.paid]
    I --> J[Webhook Handler: Update status to 'active']
```

## Screens

| Step | Screen | Notes |
|------|--------|-------|
| 1 | App Header Banner | Persistent red/orange warning for past_due users. |
| 2 | Notification Email | Direct link to update billing. |
| 3 | Billing Portal | User corrects the issue. |

## Feature Alignment
*None yet* - This handles edge cases planned for later phases.

## Status & Actual State
- **Webhook Implementation:** Planned.
- **Email Template:** Needs to be designed in React Email.
- **UI Banner:** Planned as a global component.
